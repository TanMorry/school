<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=750px, user-scalable=true"/>
    <META HTTP-EQUIV="pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
    <META HTTP-EQUIV="expires" CONTENT="0">
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
    <meta content="telephone=no" name="format-detection"/>
    <meta http-equiv="Content-Type" content="text/html;"/>
    <meta http-equiv="Content-Language" content="zh-cn"/>
    <meta name="keywords" content="keyword ..."/>
    <meta name="Description" content="description ..."/>
    <link rel="stylesheet" href="css/style.css"/>
    <link rel="stylesheet" href="css/animate.min.css"/>
    <script src="js/jqrey.min.js"></script>
    <script type="text/javascript" src="js/ali.js"></script>
    <script type="text/jscript" src="js/rem.js"></script>
    <script type="text/javascript" src="js/cookie.js"></script>

    <title>修改地址</title>
</head>
<body class="corder_back bod">
<form>
    <span class="sex">1</span>
    <span class="dizs">1</span>
    <span class="mors">0</span>
    <div class="sjld">
        <span class="sheng"></span>
        <span class="shi"></span>
        <span class="qu"></span>

        <div class="snid"></div>
        <div class="shid"></div>
        <div class="quid"></div>
    </div>
    <span class="ssq"></span>
    <span class="ssqs"></span>
    <!--/*存值*/-->

    <div class="fade_sjld bounceInUp animated ">
        <div class="header_xzdq">选择地区<span>×</span></div>
        <div class="xzdz">
        </div>
    </div>
    <div class="fade_gxs bounceInUp animated">
        <p class="ts_gx"></p>
    </div>
    <div class="container-diz">
        <div>
            <label>联系人</label>
            <input type="text" class="mph" name="user" placeholder="姓名" onfocus="this.placeholder=''"
                   onblur="this.placeholder='姓名'"/>
        </div>
        <div>
            <div class="bxa sex_bga">先生</div>
            <div class="bxb sex_bgb">女士</div>

        </div>
        <div>
            <label>电话</label>
            <input type="text" class="mob_phone" name="mob" placeholder="手机号码" onfocus="this.placeholder=''"
                   onblur="this.placeholder='手机号码'"/>
        </div>
        <div class="dzgle">
            <a>
                <label>地址</label>
                <input type="text" readonly="readonly" class="dz" name="diz" placeholder="选择收货地址"
                       onfocus="this.placeholder=''" onblur="this.placeholder='选择收货地址'"/>
                <span>></span>
            </a>
        </div>
        <div>
            <label>门牌号</label>
            <input type="text" class="mphs" name="mp" placeholder="例：5号楼203室" onfocus="this.placeholder=''"
                   onblur="this.placeholder='例：5号楼203室'"/>
        </div>
        <div>
            <label class="dz_t">地址</label>
            <div class="bxsa diz_bga">家</div>
            <div class="bxsb diz_bgb">公司</div>
            <div class="bxsc diz_bgb"> 学校</div>
        </div>
        <div>
            <label>设为默认</label>
            <div class="mr"></div>
        </div>
    </div>
    <div class="diz-footer">确认提交</div>
</form>
</body>

<script>
    $(document).ready(function () {

        /*第一次加载去请求数据开始*/
        var wap = window.location.search.substr(1)
        $.ajax({
            type: "get",
            url: "http://www.flyxiu.com/api/user/address/addr_detail",
            data: ({"addr_id": wap}),
            headers: {
                'XX-Device-Type': $.cookie('device_type'),
                'XX-Token': $.cookie('token'),
            },
            success: function (data) {
                if (data.code == 1) {
                    var data = data.data
                    console.log(data)
                    $(".mph").val(data[0].realname)
                    if (data[0].sex == 1) {
                        $(".bxa").removeClass("sex_bgb").addClass("sex_bga");
                        $(".bxb").removeClass("sex_bga").addClass("sex_bgb");
                        $(".sex").text("1")

                    } else {
                        $(".bxa").removeClass("sex_bga").addClass("sex_bgb");
                        $(".bxb").removeClass("sex_bgb").addClass("sex_bga");
                        $(".sex").text("2")
                    }
                    $(".mob_phone").val(data[0].phone)
                    $(".sheng").text(data[0].province)
                    $(".shi").text(data[0].city)
                    $(".qu").text(data[0].area)
                    var ses = $(".sjld span").text()
                    $(".dz").val(ses)
                    $(".mphs").val(data[0].street)
                    if (data[0].tig == 1) {
                        $(".bxsa").removeClass("diz_bgb").addClass("diz_bga")
                        $(".bxsb").removeClass("diz_bga").addClass("diz_bgb")
                        $(".bxsc").removeClass("diz_bga").addClass("diz_bgb")
                        $(".dizs").text("1")
                    }
                    if (data[0].tig == 2) {
                        $(".bxsa").removeClass("diz_bga").addClass("diz_bgb")
                        $(".bxsb").removeClass("diz_bgb").addClass("diz_bga")
                        $(".bxsc").removeClass("diz_bga").addClass("diz_bgb")
                        $(".dizs").text("2")
                    }
                    if (data[0].tig == 3) {
                        $(".bxsa").removeClass("diz_bga").addClass("diz_bgb")
                        $(".bxsb").removeClass("diz_bga").addClass("diz_bgb")
                        $(".bxsc").removeClass("diz_bgb").addClass("diz_bga")
                        $(".dizs").text("3")

                    }
                    if (data[0].is_default == 0) {
                        $(".mr").removeClass("diz_bgas")
                        $(".mr").text("")
                        $(".mors").text("0")
                    } else {
                        $(".mr").addClass("diz_bgas")
                        $(".mr").text("√")
                        $(".mors").text("1")

                    }
                }

            }

        })


        /*第一次加载去请求数据结束*/
        var sex = "0"
        var diz = "0"
        var mos = "0"
        /*收货地址验证*/
        $("input[name=mp]").on('change', function () {
            var use = $(this).val()
            if (use == null || use == undefined || use == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("门牌不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })

        $("input[name=mp]").on('blur', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("门牌不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        $("input[name=mp]").on('keyup', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("门牌不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        $("input[name=mp]").on('keydown', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("门牌不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        /*收货地址验证*/

        /*收货地址验证*/
        $("input[name=diz]").on('change', function () {
            var use = $(this).val()
            if (use == null || use == undefined || use == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("收货地址不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })

        $("input[name=diz]").on('blur', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("收货地址不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        $("input[name=diz]").on('keyup', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("收货地址不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        $("input[name=diz]").on('keydown', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("收货地址不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        /*收货地址验证*/


        /*联系人验证*/
        $("input[name=diz]").on('change', function () {
            var use = $(this).val()
            if (use == null || use == undefined || use == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("收货地址不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })

        $("input[name=diz]").on('blur', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("收货地址不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        $("input[name=diz]").on('keyup', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("收货地址不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        $("input[name=diz]").on('keydown', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("收货地址不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        /*联系人验证*/
        /*联系人验证*/
        $("input[name=user]").on('change', function () {
            var use = $(this).val()
            if (use == null || use == undefined || use == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("联系人不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })

        $("input[name=user]").on('blur', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("联系人不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        $("input[name=user]").on('keyup', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("联系人不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        $("input[name=user]").on('keydown', function () {
            var usel = $(this).val()
            if (usel == null || usel == undefined || usel == "") {
                $(".fade_gxs").show()
                $(".ts_gx").text("联系人不能为空")
            } else {
                $(".fade_gxs").hide()
                $(".ts_gx").text("")
            }
        })
        /*联系人验证*/
        $("input[name=mob]").on('change', function () {
            var phone = $(this).val()
            console.log(phone)
            if (!(/^1[34578]\d{9}$/.test(phone))) {
                $(".fade_gxs").show();
                $(".ts_gx").text("手机号码输入错误请重新输入")
            } else {
                $(".fade_gxs").hide();
                $(".ts_gx").text("")
            }
        })
        $("input[name=mob]").on('blur', function () {
            var phones = $(this).val()
            if (!(/^1[34578]\d{9}$/.test(phones))) {
                $(".fade_gxs").show();
                $(".ts_gx").text("手机号码输入错误请重新输入")
            } else {
                $(".fade_gxs").hide();
                $(".ts_gx").text("")
            }
        })
        $("input[name=mob]").on('keyup', function () {
            var phones = $(this).val()
            if (!(/^1[34578]\d{9}$/.test(phones))) {
                $(".fade_gxs").show();
                $(".ts_gx").text("手机号码输入错误请重新输入")
            } else {
                $(".fade_gxs").hide();
                $(".ts_gx").text("")
            }
        })
        $("input[name=mob]").on('keydown', function () {
            var phones = $(this).val()
            if (!(/^1[34578]\d{9}$/.test(phones))) {
                $(".fade_gxs").show();
                $(".ts_gx").text("手机号码输入错误请重新输入")
            } else {
                $(".fade_gxs").hide();
                $(".ts_gx").text("")
            }
        })


        /*性别选择*/

        $(".bxa").on('click', function () {
            $(this).removeClass("sex_bgb").addClass("sex_bga").siblings(".bxb").removeClass("sex_bga");
            sex = 1
            $(".sex").text(sex)
        })
        $(".bxb").on('click', function () {
            $(this).removeClass("sex_bgb").addClass("sex_bga").siblings(".bxa").removeClass("sex_bga");
            sex = 2
            $(".sex").text(sex)
        })
        $(".bxsa").on('click', function () {
            $(this).removeClass("diz_bgb").addClass("diz_bga")
            $(".bxsb").removeClass("diz_bga")
            $(".bxsc").removeClass("diz_bga")
            if ($(this).has("diz_bga")) {
                diz = 1
                $(".dizs").text(diz)
            }

        })
        $(".bxsb").on('click', function () {
            $(this).removeClass("diz_bgb").addClass("diz_bga")
            $(".bxsc").removeClass("diz_bga")
            $(".bxsa").removeClass("diz_bga")
            if ($(this).has("diz_bga")) {
                diz = 2
                $(".dizs").text(diz)
            }

        })
        $(".bxsc").on('click', function () {
            $(this).removeClass("diz_bgb").addClass("diz_bga")
            $(".bxsa").removeClass("diz_bga")
            $(".bxsb").removeClass("diz_bga")
            if ($(this).has("diz_bga")) {
                diz = 3
                $(".dizs").text(diz)
            }
        })


        $(".mr").on('click', function () {
            $(this).toggleClass("diz_bgas").text("√");
            if (!$(this).hasClass("diz_bgas")) {
                $(this).text("")
                mos = 0
                $(".mors").text(mos)

            } else {
                mos = 1
                $(".mors").text(mos)
            }
        })


        /*表单提交*/


        $(".diz-footer").on('click', function () {
            var hr = window.location.search.substr(1)
            var a = $("input[name=user]").val()
            var b = $(".sex").text()
            var c = $("input[name=mob]").val()
            var d = $("input[name=diz]").val()
            var e = $("input[name=mp]").val()
            var f = $(".dizs").text()
            var h = $(".mors").text()
            var sen = $(".sheng").text()
            var sh = $(".shi").text()
            var qu = $(".qu").text()
            var xxvl = $(".ssq").text();
            console.log(f)
            if (a == null || a == undefined || a == "") {
                $(".fade_gxs").show();
                $(".ts_gx").text("联系人不能为空")
                return false
            }
            if (!(/^1[34578]\d{9}$/.test(c))) {
                $(".fade_gxs").show();
                $(".ts_gx").text("手机号码输入错误请重新输入")
                return false
            }
            if (d == null || d == undefined || d == "") {
                $(".fade_gxs").show();
                $(".ts_gx").text("收货地址不能为空")
                return false
            }
            if (e == null || e == undefined || e == "") {
                $(".fade_gxs").show();
                $(".ts_gx").text("门牌不能为空")
                return false
            }

            $.ajax({
                type: "post",
                url: "http://www.flyxiu.com/api/user/address/edit",
                headers: {
                    'XX-Device-Type': $.cookie('device_type'),
                    'XX-Token': $.cookie('token'),
                },
                data: ({
                    "id": hr,
                    "realname": a,
                    "phone": c,
                    "sex": b,
                    "province": sen,
                    "city": sh,
                    "area": qu,
                    "street": e,
                    "tig": f,
                    "is_default": h
                }),
                success: function (data) {
                    if (data.code == 1) {
                        $(".fade_gxs").show();
                        $(".ts_gx").text("提交成功...请稍等正在为您处理")
                        setTimeout(function () {
                            window.location.href = "dzgl.html";
                        }, 3000);
                    }


                }

            })

        })

        /*三级联动地址获取开始*/

        $(".header_xzdq span").on('click', function () {
            $(".fade_sjld").hide()

        })


        $(".dz").on('click', function () {
            var thisl = $(this).val()
            console.log(thisl)
            if (thisl == "" || this == undefined || thisl == null) {


                $.ajax({
                    type: "get",
                    url: "http://www.flyxiu.com/api/user/address/get_addr",
                    headers: {
                        'XX-Device-Type': $.cookie('device_type'),
                        'XX-Token': $.cookie('token'),
                    },
                    success: function (data) {


                        if (data.code == 1) {

                            $(".fade_sjld").show()
                            console.log(data)
                            var tema = data.data.provinces

                            $.each(tema, function (key, val) {

                                $(".xzdz").append(
                                    '<div data-id="' + tema[key].provinceid + '"><span>' + tema[key].province + '</span></div>'
                                )


                            })

                            $(".xzdz div").on('click', function () {
                                var valuea = $(this).text()
                                $(".sheng").text(valuea)
                                var ids = $(this).attr("data-id")
                                $(".snid").text(ids)
                                var idss = $(".snid").text()
                                $.ajax({
                                    type: "get",
                                    url: "http://www.flyxiu.com/api/user/address/get_addr",
                                    data: ({"province_id": idss}),
                                    headers: {
                                        'XX-Device-Type': $.cookie('device_type'),
                                        'XX-Token': $.cookie('token'),
                                    },
                                    success: function (data) {
                                        console.log(data)
                                        if (data.code == 1) {
                                            $(".xzdz ").html("")
                                            var temb = data.data.cities
                                            console.log(temb)
                                            $.each(temb, function (key, val) {

                                                $(".xzdz").append(
                                                    '<div data-id="' + temb[key].cityid + '"><span>' + temb[key].city + '</span></div>'
                                                )


                                            })

                                            $(".xzdz div").on('click', function () {
                                                var valueb = $(this).text()
                                                $(".shi").text(valueb)
                                                var idsa = $(this).attr("data-id")
                                                var idsas = $(".shid").text()
                                                $(".shid").text(idsa)
                                                var idss = $(".shid").text()


                                                $.ajax({
                                                    type: "get",
                                                    url: "http://www.flyxiu.com/api/user/address/get_addr",
                                                    data: ({"city_id": idss}),
                                                    headers: {
                                                        'XX-Device-Type': $.cookie('device_type'),
                                                        'XX-Token': $.cookie('token'),
                                                    },
                                                    success: function (data) {

                                                        console.log(data)
                                                        if (data.code == 1) {
                                                            $(".xzdz ").html("")
                                                            var temc = data.data.areas
                                                            $.each(temc, function (key, val) {

                                                                $(".xzdz").append(
                                                                    '<div data-id="' + temc[key].areaid + '"><span >' + temc[key].area + '</span></div>'
                                                                )


                                                            })
                                                            $(".xzdz div").on('click', function () {
                                                                var valuec = $(this).text()
                                                                var values = $(this).attr("data-id")
                                                                $(".qu").text(valuec)
                                                                $(".quid").text(values)
                                                                var valued = $(".sjld span").text()
                                                                $(".ssq").text(valued)
                                                                console.log(valued)
                                                                $(".dz").val(valued)
                                                                $(".fade_sjld").hide()
                                                                $(".fade_gxs").hide()
                                                                $(".ts_gx").text("")


                                                            })

                                                        }

                                                    }

                                                })


//                  		 	/8**寻找8/


                                            })

                                        }

                                    }

                                })


                            })


                        }

                    }

                })


                /*第一次联动*/

            } else {
                /*第二次联动*/

                $(".dz").val("")

                $.ajax({
                    type: "get",
                    url: "http://www.flyxiu.com/api/user/address/get_addr",
                    headers: {
                        'XX-Device-Type': $.cookie('device_type'),
                        'XX-Token': $.cookie('token'),
                    },
                    success: function (data) {

                        console.log(data)
                        if (data.code == 1) {
                            $(".xzdz").html("")
                            $(".fade_sjld").show()
                            console.log(data)
                            var tma = data.data.provinces

                            $.each(tma, function (key, val) {

                                $(".xzdz").append(
                                    '<div data-id="' + tma[key].provinceid + '"><span>' + tma[key].province + '</span></div>'
                                )


                            })

                            $(".xzdz div").on('click', function () {
                                var valuea = $(this).text()
                                $(".sheng").text(valuea)
                                var ibs = $(this).attr("data-id")
                                $(".snid").text(ibs)
                                var idss = $(".snid").text()
                                $.ajax({
                                    type: "get",
                                    url: "http://www.flyxiu.com/api/user/address/get_addr",
                                    data: ({"province_id": ibs}),
                                    headers: {
                                        'XX-Device-Type': $.cookie('device_type'),
                                        'XX-Token': $.cookie('token'),
                                    },
                                    success: function (data) {
                                        console.log(data)
                                        if (data.code == 1) {
                                            $(".xzdz").html("")
                                            console.log(data)
                                            var tmb = data.data.cities
                                            $.each(tmb, function (key, val) {

                                                $(".xzdz").append(
                                                    '<div data-id="' + tmb[key].cityid + '"><span>' + tmb[key].city + '</span></div>'
                                                )


                                            })
                                            $(".xzdz div").on('click', function () {
                                                alert(2)

                                                var valueb = $(this).text()
                                                $(".shi").text(valueb)
                                                var ibsa = $(this).attr("data-id")
                                                $(".shid").text(ibsa)
                                                var idsas = $(".shid").text()


                                                $.ajax({
                                                    type: "get",
                                                    url: "http://www.flyxiu.com/api/user/address/get_addr",
                                                    data: ({"city_id": idsas}),
                                                    headers: {
                                                        'XX-Device-Type': $.cookie('device_type'),
                                                        'XX-Token': $.cookie('token'),
                                                    },
                                                    success: function (data) {
                                                        console.log(data)
                                                        if (data.code == 1) {
                                                            $(".xzdz").html("")
                                                            console.log(data)
                                                            var tmc = data.data.areas

                                                            console.log(tmc)
                                                            $.each(tmc, function (key, val) {

                                                                $(".xzdz").append(
                                                                    '<div data-id="' + tmc[key].areaid + '"><span>' + tmc[key].area + '</span></div>'
                                                                )
                                                            })
                                                            $(".xzdz div").on('click', function () {
                                                                var valuecs = $(this).text()
                                                                $(".qu").text(valuecs)
                                                                var vak = $(this).attr("data-id")
                                                                $("quid").text(vak)
                                                                var valued = $(".sjld span").text()
                                                                $(".ssq").text(valued)
                                                                console.log(valued)
                                                                $(".dz").val(valued)
                                                                $(".fade_sjld").hide()
                                                                $(".fade_gxs").hide()
                                                                $(".ts_gx").text("")


                                                            })


                                                        }

                                                    }

                                                })


                                            })


                                        }

                                    }

                                })


                            })


                        }

                    }

                })


            }


        })


//			/*三级联动地址获取结束*/


    })

</script>
</html>
